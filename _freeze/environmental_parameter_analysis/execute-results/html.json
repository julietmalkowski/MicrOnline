{
  "hash": "238ff206ab7bc40be6cb8c059aa21055",
  "result": {
    "engine": "knitr",
    "markdown": "# Environmental Parameter Analysis\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: permute\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: lattice\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis is vegan 2.6-4\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: ape\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: nlme\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:nlme':\n\n    collapse\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ape':\n\n    where\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nmicrobiome R package (microbiome.github.com)\n    \n\n\n Copyright (C) 2011-2022 Leo Lahti, \n    Sudarshan Shetty et al. <microbiome.github.io>\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'microbiome'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ggplot2':\n\n    alpha\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:vegan':\n\n    diversity\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:base':\n\n    transform\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ forcats   1.0.0     ✔ readr     2.1.5\n✔ lubridate 1.9.3     ✔ stringr   1.5.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ microbiome::alpha() masks ggplot2::alpha()\n✖ dplyr::collapse()   masks nlme::collapse()\n✖ dplyr::filter()     masks stats::filter()\n✖ dplyr::lag()        masks stats::lag()\n✖ dplyr::where()      masks ape::where()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n\nAttaching package: 'reshape2'\n\n\nThe following object is masked from 'package:tidyr':\n\n    smiths\n\n\n\nAttaching package: 'ggpubr'\n\n\nThe following object is masked from 'package:ape':\n\n    rotate\n```\n\n\n:::\n:::\n\n\n\n\n## Loading Metadata\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\notu_mat<- read_excel(\"/Users/julietmalkowski/Desktop/Research/Kinetic_Model/abundance_table.xlsx\")\n#remove first 4 characters in every column name\ncolnames(otu_mat)<- substr(colnames(otu_mat), 5, nchar(colnames(otu_mat)))\notu_mat = as.data.frame(otu_mat)\n#split first column by character '_' into two seperate columns\notu_mat[c('Process', 'Date')] <- str_split_fixed(otu_mat$le, '_', 2)\n#drop le column\notu_mat = otu_mat[,-1]\n#move last two columns to the front\notu_mat <- otu_mat %>%\n  select(Process, everything())\notu_mat <- otu_mat %>%\n  select(Date, everything())\n#filter otu_mat to only contain AS-1 and AS-2 in process column\notu_mat <- otu_mat %>%\n  filter(Process == \"AS-1\" | Process == \"AS-2\")\n#remove Process column\notu_mat = otu_mat[,-2]\n#groupby date and find the mean of each column\notu_counts <- otu_mat %>%\n  group_by(Date) %>%\n  summarise_all(mean)\notu_p = otu_counts\n#find the sum of each row\notu_p$sum <- rowSums(otu_p[,-1])\n#divide each row by the sum\notu_p[,-1] <- otu_p[,-1] / otu_p$sum\n#remove sum column\notu_p = otu_p[,-ncol(otu_p)]\n#make otu_p from wide form to long form\notu_p <- otu_p %>%\n  pivot_longer(cols = -Date, names_to = \"OTU\", values_to = \"Abundance\")\n#filter out rows with an Abundance less than 0.01\notu_p <- otu_p %>%\n  filter(Abundance >= 0.01)\n#calculate Shannon Index and add it to otu_p column\nshannon = function(x) {\n  -sum(x * log(x))\n}\notu_shannon = otu_p\ns = otu_shannon %>% group_by(Date) %>%\n  summarize(Shannon = shannon(Abundance))\notu_shannon = merge(otu_shannon, s, by = \"Date\")\n\noutput_metadata <- read_excel(\"/Users/julietmalkowski/Desktop/Research/Kinetic_Model/AS_metadata.xlsx\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNew names:\n• `` -> `...1`\n```\n\n\n:::\n\n```{.r .cell-code}\noutput_metadata = as.data.frame(output_metadata)\n\n#input parameters\ninput_metadata = output_metadata\ninput_metadata = input_metadata[,c(2,3,5,7,10,12,14,16,18,20)]\ninput_data = input_metadata\ninput_data = merge(otu_shannon, input_metadata, by = \"Date\")\n\n#output parameters\noutput_metadata = output_metadata[,-c(1,3:8,10,12,14:20)]\noutput_data = merge(otu_shannon, output_metadata, by = \"Date\")\n#change column 6 name\ncolnames(output_data)[6] <- \"BOD_CBOD_Load_Removed\"\n#remove column in output_data\ninput_data_ = input_data[,-c(2:4)]\ninput_data_ = as.data.frame(input_data_)\n#remove duplicates\ninput_data_ = input_data_[!duplicated(input_data_[,1]),]\n#make first column rownames in output_data_\nrownames(input_data_) <- input_data_[,1]\n#remove first column\ninput_data_ = input_data_[,-1]\n#move rowcols to first column\ninput_data_ = cbind(Date = rownames(input_data_), input_data_)\ninput_data_$Date <- mdy(input_data_$Date)\n#remove rownames\nrownames(input_data_) <- NULL\n\n#remove column in output_data\noutput_data_ = output_data[,-c(2:5)]\noutput_data_ = as.data.frame(output_data_)\n#remove duplicates\noutput_data_ = output_data_[!duplicated(output_data_[,1]),]\n#make first column rownames in output_data_\nrownames(output_data_) <- output_data_[,1]\n#remove first column\noutput_data_ = output_data_[,-1]\n#move rowcols to first column\noutput_data_ = cbind(Date = rownames(output_data_), output_data_)\n#remove rownames\nrownames(output_data_) <- NULL\n#make date column numeric\noutput_data_$Date <- mdy(output_data_$Date)\n```\n:::\n\n\n\n\n## Input Visualization\n\n#RDA selected values only\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ne = ggplot() + \n  geom_line(data=input_data_,aes(x = Date,y = temp_RSS, color = \"temp_RSS\"),group = 1) +\n  ggtitle(\"RSS Temp Over Time\") + xlab(\"Month\") + ylab(\"temp (deg.C)\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nf = ggplot() + \n  geom_line(data=input_data_,aes(x = Date,y = SCT_Detention_Time, color = \"SCT_Detention_Time\"),group = 1) + \n  ggtitle(\"SCT_Detention_Time Over Time\") + xlab(\"Month\") + ylab(\"time (hr)\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\ng = ggplot() + \n  geom_line(data=input_data_,aes(x = Date,y = P_Load_PE, color = \"P_Load_PE\"),group = 1) + \n  ggtitle(\"P_Load_PE Over Time\") + xlab(\"Month\") + ylab(\"mg/L\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nh = ggplot() + \n  geom_line(data=input_data_,aes(x = Date,y = TKN_Load_RAW, color = \"TKN_Load_RAW\"),group = 1) + \n  ggtitle(\"TKN_Load_RAW Over Time\") + xlab(\"Month\") + ylab(\"mg/L\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\ni = ggplot() + \n  geom_line(data=input_data_,aes(x = Date,y = Ammonia_Load_RAW, color = \"Ammonia_Load_RAW\"),group = 1) + \n  ggtitle(\"Ammonia_Load_RAW\") + xlab(\"Month\") + ylab(\"mg/L\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nggarrange(e, f, g, h, i + rremove(\"x.text\"), \n          labels = c(\"A\", \"B\", \"C\", \"D\", \"E\"),\n          ncol = 2, nrow = 3)\n```\n\n::: {.cell-output-display}\n![](environmental_parameter_analysis_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n## Output Visualization\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\na = ggplot() + \n  geom_line(data=output_data_,aes(x = Date,y = BOD_CBOD_Load_Removed, color = \"BOD_CBOD_Load_Removed\"),group = 1) + \n  geom_line(data=output_data_,aes(x = Date, y = COD_Load_Removed,color = \"COD_Load_Removed\"),group = 1) +\n  ggtitle(\"Output Parameters Over Time\") + xlab(\"Month\") + ylab(\"tonnes/day\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nb = ggplot() + \n  geom_line(data=output_data_,aes(x = Date,y = BOD_CBOD_Load_Removed, color = \"P_Removed\"),group = 1) + \n  ggtitle(\"P_Removed Over Time\") + xlab(\"Month\") + ylab(\"tonnes/day\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nc = ggplot() + \n  geom_line(data=output_data_,aes(x = Date,y = TKN_Removed, color = \"TKN_Removed\"),group = 1) + \n  ggtitle(\"TKN_Removed Over Time\") + xlab(\"Month\") + ylab(\"tonnes/day\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nd = ggplot() + \n  geom_line(data=output_data_,aes(x = Date,y = Ammonia_Removed, color = \"Ammonia_Removed\"),group = 1) + \n  ggtitle(\"Ammonia_Removed Over Time\") + xlab(\"Month\") + ylab(\"tonnes/day\") + \n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%m\") + theme(legend.position=\"top\")\n\nggarrange(a, b, c, d + rremove(\"x.text\"), \n          labels = c(\"A\", \"B\", \"C\", \"D\"),\n          ncol = 2, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](environmental_parameter_analysis_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n## Shannon Index Visualization\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_line(data=s,aes(x = Date,y = Shannon, color = \"Shannon\"),group = 1) + \n  ggtitle(\"Shannon Index Over Time\") + xlab(\"Date\") + ylab(\"Shannon Index\") + theme(legend.position=\"top\") +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](environmental_parameter_analysis_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n## OTU 1,4,2,6 Visualization\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#put character z in front of all columns\ncolnames(otu_counts) <- paste0(\"z\", colnames(otu_counts))\n#select only columns named '1' in otu_counts\notus <- select(otu_counts,z1,z4,z2,z6,zDate)\n\n#plot the data\nggplot() + \n  geom_line(data=otus,aes(x = zDate, y = z1, color = \"1\"),group = 1) + \n  geom_line(data=otus,aes(x = zDate, y = z4,color = \"4\"),group = 1) +\n  geom_line(data=otus,aes(x = zDate, y = z2,color = \"2\"),group = 1) +\n  geom_line(data=otus,aes(x = zDate, y = z6 ,color = \"6\"),group = 1) +\n  ggtitle(\"OTU 1,4,2,6 Over Time\") + xlab(\"Date\") + ylab(\"Abundance\") + theme(legend.position=\"top\") +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](environmental_parameter_analysis_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "environmental_parameter_analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}